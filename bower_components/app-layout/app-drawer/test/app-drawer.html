<!DOCTYPE html><html><head>
  <meta charset="UTF-8">
  <title>test for app-drawer</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">

  <script src="../../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../../web-component-tester/browser.js"></script>
  <script src="../../../test-fixture/test-fixture-mocha.js"></script>
  <link rel="import" href="../../../polymer/polymer.html">
  <link rel="import" href="../../../test-fixture/test-fixture.html">
  <link rel="import" href="../app-drawer.html">
  <style is="custom-style">body{margin:0;}</style>
</head>
<body>

  <test-fixture id="testDrawer">
    <template>
      <app-drawer></app-drawer>
    </template>
  </test-fixture>

  <test-fixture id="rtlDrawer">
    <template>
      <app-drawer dir="rtl"></app-drawer>
    </template>
  </test-fixture>

  <test-fixture id="focusDrawer">
    <template>
      <focus-drawer></focus-drawer>
    </template>
  </test-fixture>

  <dom-module id="focus-drawer">
    <template>
      <app-drawer>
        <input type="text">
        <div tabindex="0">Div</div>
        <span>Not focusable</span>
      </app-drawer>
    </template>
    <script>HTMLImports.whenReady(function(){Polymer({is:"focus-drawer"})});</script>
  </dom-module>

  <script>suite("basic features",function(){function e(e,t,s){var r=new CustomEvent("keydown",{bubbles:!0,cancelable:!0});return r.keyCode=t,r.shiftKey=!!s,e.dispatchEvent(r),r}function t(e,t,s){assert.equal(l.lastCall.args[0],"translate3d("+e+"px,0,0)",s),assert.equal(parseFloat(d.style.opacity).toFixed(4),t.toFixed(4),s)}function s(){assert.equal(d.style.opacity,""),assert.equal(l.lastCall.args[0],"")}function r(e){assert.equal(o.style.transitionDuration,e),assert.equal(d.style.transitionDuration,e)}function a(e){assert.isAbove(parseFloat(o.style.transitionDuration),e),assert.isAbove(parseFloat(d.style.transitionDuration),e)}function n(e){assert.equal(o.style.transitionTimingFunction,e),assert.equal(d.style.transitionTimingFunction,e)}var i,d,o,l;setup(function(){i=fixture("testDrawer"),d=i.$.scrim,o=i.$.contentContainer,l=sinon.spy(i,"transform")}),test("default values",function(){assert.isFalse(i.opened),assert.isFalse(i.persistent),assert.equal(i.transitionDuration,200),assert.equal(i.align,"left"),assert.isFalse(i.swipeOpen),assert.isFalse(i.noFocusTrap)}),test("set scroll direction",function(e){Polymer.RenderStatus.afterNextRender(i,function(){assert.equal(i.__polymerGesturesTouchAction,"pan-y"),e()})}),test("transitionDuration property",function(e){Polymer.RenderStatus.afterNextRender(i,function(){r("200ms"),i.transitionDuration=10,r("10ms"),e()})}),test("transitions are enabled after attached",function(e){r("0ms"),Polymer.RenderStatus.afterNextRender(i,function(){r("200ms"),e()})}),test("computed position",function(){rtlDrawer.align="start",assert.equal(i.position,"left"),i.align="end",assert.equal(i.position,"right"),i.align="left",assert.equal(i.position,"left"),i.align="right",assert.equal(i.position,"right")}),test("computed position for RTL",function(){var e=fixture("rtlDrawer");e.align="start",assert.equal(e.position,"right"),e.align="end",assert.equal(e.position,"left"),e.align="right",assert.equal(e.position,"right"),e.align="left",assert.equal(e.position,"left")}),test("left drawer opens and closes",function(){i.align="left";var e=o.getBoundingClientRect();assert.isTrue(e.right<=0),i.opened=!0,e=o.getBoundingClientRect(),assert.equal(e.left,0),i.opened=!1,e=o.getBoundingClientRect(),assert.isTrue(e.right<=0)}),test("right drawer opens and closes",function(){i.align="right";var e=o.getBoundingClientRect();assert.isTrue(e.left>=window.innerWidth),i.opened=!0,e=o.getBoundingClientRect(),assert.equal(e.right,window.innerWidth),i.opened=!1,e=o.getBoundingClientRect(),assert.isTrue(e.left>=window.innerWidth)}),test("open(), close(), and toggle()",function(){assert.isFalse(i.opened),i.open(),assert.isTrue(i.opened),i.close(),assert.isFalse(i.opened),i.toggle(),assert.isTrue(i.opened),i.toggle(),assert.isFalse(i.opened)}),test("getWidth()",function(){assert.equal(i.getWidth(),o.offsetWidth)}),test("app-drawer-reset-layout",function(){var e=sinon.spy();i.addEventListener("app-drawer-reset-layout",e),i.align="right",assert.isTrue(e.called)}),test("app-drawer-transitioned",function(e){window.setTimeout(function(){var t=sinon.spy();i.transitionDuration=1,i.addEventListener("app-drawer-transitioned",t),i.persistent=!0,assert.isFalse(t.called,"should not fire after toggling persistent when closed"),i.opened=!0,window.setTimeout(function(){assert.equal(t.callCount,1,"should fire after toggling opened state"),i.persistent=!1,window.setTimeout(function(){assert.equal(t.callCount,2,"should fire after toggling persistent when opened"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:-200,ddx:-200}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(t.callCount,3,"should fire after flinging"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:10,ddx:10}),i.fire("track",{state:"end",dx:10,ddx:0}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(t.callCount,4,"should fire after swiping even if opened state unchanged"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:200,ddx:200}),i.fire("track",{state:"end",dx:200,ddx:0}),window.setTimeout(function(){assert.isTrue(i.opened),assert.equal(t.callCount,5,"should fire after swiping"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:-1e3,ddx:-1e3}),i.fire("track",{state:"end",dx:-1e3,ddx:0}),window.setTimeout(function(){assert.isFalse(i.opened),assert.equal(t.callCount,6,"should fire after swiping beyond end state"),e()},150)},150)},150)},150)},150)},150)},100)}),test("app-drawer-transitioned when transitionDuration is 0",function(e){Polymer.RenderStatus.afterNextRender(i,function(){var t=sinon.spy();i.transitionDuration=0,i.addEventListener("app-drawer-transitioned",t),i.persistent=!0,assert.isFalse(t.called,"should not fire after toggling persistent when closed"),i.opened=!0,assert.equal(t.callCount,1,"should fire after toggling opened state"),i.persistent=!1,assert.equal(t.callCount,2,"should fire after toggling persistent when opened"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:-200,ddx:-200}),assert.isFalse(i.opened),assert.equal(t.callCount,3,"should fire after flinging"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:200,ddx:200}),i.fire("track",{state:"end",dx:200,ddx:0}),assert.isTrue(i.opened),assert.equal(t.callCount,4,"should fire after swiping"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:-1e3,ddx:-1e3}),i.fire("track",{state:"end",dx:-1e3,ddx:0}),assert.isFalse(i.opened),assert.equal(t.callCount,5,"should fire after swiping beyond end state"),e()})}),test("track events block user selection",function(e){Polymer.RenderStatus.afterNextRender(i,function(){var t=i.fire("track",null,{cancelable:!0});assert.isTrue(t.defaultPrevented),e()})}),test("styles reset after swiping",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.fire("track",{state:"start"}),assert.equal(i.style.visibility,"visible"),r("0ms"),i.fire("track",{state:"track",dx:200,ddx:200}),i.fire("track",{state:"end",dx:200,ddx:0}),assert.equal(i.style.visibility,""),r("200ms"),s(),e()})}),test("styles reset after swiping beyond the end state",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.fire("track",{state:"start"}),assert.equal(i.style.visibility,"visible"),r("0ms"),i.fire("track",{state:"track",dx:1e3,ddx:1e3}),i.fire("track",{state:"end",dx:1e3,ddx:0}),assert.equal(i.style.visibility,""),r("200ms"),s(),e()})}),test("left drawer swiping",function(e){Polymer.RenderStatus.afterNextRender(i,function(){var s=i.getWidth(),r=s/2;i.align="left",i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:-r,ddx:-r}),t(-s,0,"styles are lower bounded"),i.fire("track",{state:"track",dx:r,ddx:s}),t(-r,.5,"style by track distance"),i.fire("track",{state:"track",dx:r+s,ddx:s}),t(0,1,"styles are upper bounded"),i._trackDetails=[],i.fire("track",{state:"end",dx:r,ddx:-s}),assert.isFalse(i.opened,"drawer stays closed when track distance is small"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:r+1,ddx:r+1}),i.fire("track",{state:"end",dx:r+1,ddx:0}),assert.isTrue(i.opened,"drawer opens when track distance is large"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:-r,ddx:-r}),i.fire("track",{state:"end",dx:-r,ddx:0}),assert.isTrue(i.opened,"drawer stays opened when track distance is small"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:-r-1,ddx:-r-1}),i.fire("track",{state:"end",dx:-r-1,ddx:0}),assert.isFalse(i.opened,"drawer closes when track distance is large"),e()})}),test("right drawer swiping",function(e){Polymer.RenderStatus.afterNextRender(i,function(){var s=i.getWidth(),r=s/2;i.align="right",i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:r,ddx:r}),t(s,0,"styles are lower bounded"),i.fire("track",{state:"track",dx:-r,ddx:-s}),t(r,.5,"style by track distance"),i.fire("track",{state:"track",dx:-r-s,ddx:-s}),t(0,1,"styles are upper bounded"),i._trackDetails=[],i.fire("track",{state:"end",dx:-r,ddx:s}),assert.isFalse(i.opened,"drawer stays closed when track distance is small"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:-r-1,ddx:-r-1}),i.fire("track",{state:"end",dx:-r-1,ddx:0}),assert.isTrue(i.opened,"drawer opens when track distance is large"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:r,ddx:r}),i.fire("track",{state:"end",dx:r,ddx:0}),assert.isTrue(i.opened,"drawer stays opened when track distance is small"),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:r+1,ddx:r+1}),i.fire("track",{state:"end",dx:r+1,ddx:0}),assert.isFalse(i.opened,"drawer closes when track distance is large"),e()})}),test("styles reset after flinging",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.fire("track",{state:"start"}),assert.equal(i.style.visibility,"visible"),r("0ms"),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:200,ddx:200}),window.setTimeout(function(){assert.equal(i.style.visibility,""),r("200ms"),n(""),s(),e()},150)})}),test("styles reset after flinging beyond the end state",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.fire("track",{state:"start"}),assert.equal(i.style.visibility,"visible"),r("0ms"),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:1e3,ddx:1e3}),assert.equal(i.style.visibility,""),r("200ms"),n(""),s(),e()})}),test("left drawer flinging open",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.align="left",i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:.1,ddx:.1}),assert.isFalse(i.opened,"drawer stays closed when velocity is small"),r("200ms"),n(""),s(),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:6,ddx:6}),assert.isTrue(i.opened,"drawer opens when velocity is large"),a(60),n(i._FLING_TIMING_FUNCTION),s(),e()})}),test("left drawer flinging close",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.align="left",i.opened=!0,i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:-.1,ddx:-.1}),assert.isTrue(i.opened,"drawer stays opened when velocity is small"),r("200ms"),n(""),s(),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:-6,ddx:-6}),assert.isFalse(i.opened,"drawer closes when velocity is large"),a(60),n(i._FLING_TIMING_FUNCTION),s(),e()})}),test("right drawer flinging open",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.align="right",i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:-.1,ddx:-.1}),assert.isFalse(i.opened,"drawer stays closed when velocity is small"),r("200ms"),n(""),s(),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:-6,ddx:-6}),assert.isTrue(i.opened,"drawer opens when velocity is large"),a(60),n(i._FLING_TIMING_FUNCTION),s(),e()})}),test("right drawer flinging close",function(e){Polymer.RenderStatus.afterNextRender(i,function(){i.align="right",i.opened=!0,i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:.1,ddx:.1}),assert.isTrue(i.opened,"drawer stays opened when velocity is small"),r("200ms"),n(""),s(),i.fire("track",{state:"start"}),i.fire("track",{state:"track",dx:0,ddx:0}),i.fire("track",{state:"end",dx:6,ddx:6}),assert.isFalse(i.opened,"drawer closes when velocity is large"),a(60),n(i._FLING_TIMING_FUNCTION),s(),e()})}),test("doc scroll",function(){i.transitionDuration=0,i.opened=!0,assert.equal(document.body.style.overflow,"hidden","should block scrolling when opened"),i.persistent=!0,assert.equal(document.body.style.overflow,"","should not block scrolling when persistent"),i.persistent=!1,assert.equal(document.body.style.overflow,"hidden","should block scrolling when not persistent"),i.opened=!1,assert.equal(document.body.style.overflow,"","should not block scrolling when closed")}),test("focus trap",function(t){var s=fixture("focusDrawer"),r=Polymer.dom(s.root),a=r.querySelector("app-drawer"),n=Polymer.dom(a).querySelector("input"),i=Polymer.dom(a).querySelector("div[tabindex]"),d=sinon.spy(n,"focus"),o=sinon.spy(i,"focus");Polymer.RenderStatus.afterNextRender(a,function(){a.transitionDuration=0,a.opened=!0,assert.isTrue(d.called);var s=e(n,9);assert.isFalse(s.defaultPrevented,"should not prevent default"),n.focus(),d.reset(),s=e(n,9,!0),assert.isTrue(o.called),assert.isTrue(s.defaultPrevented,"should prevent default"),s=e(i,9,!0),assert.isFalse(s.defaultPrevented,"should not prevent default"),i.focus(),s=e(i,9),assert.isTrue(d.called),assert.isTrue(s.defaultPrevented,"should prevent default"),t()})}),test("focus trap with app-drawer tabindex set",function(e){var t=fixture("focusDrawer"),s=Polymer.dom(t.root),r=s.querySelector("app-drawer"),a=Polymer.dom(r).querySelector("input"),n=sinon.spy(r,"focus"),i=sinon.spy(a,"focus");Polymer.RenderStatus.afterNextRender(r,function(){r.transitionDuration=0,r.tabIndex=0,r.opened=!0,assert.isTrue(n.called),assert.isFalse(i.called),e()})}),test("no focus trap",function(e){var t=fixture("focusDrawer"),s=Polymer.dom(t.root),r=s.querySelector("app-drawer"),a=Polymer.dom(r).querySelector("input"),n=sinon.spy(a,"focus");Polymer.RenderStatus.afterNextRender(r,function(){r.transitionDuration=0,r.noFocusTrap=!0,r.opened=!0,assert.isFalse(n.called),e()})}),test("esc key handler",function(t){Polymer.RenderStatus.afterNextRender(i,function(){i.transitionDuration=0,i.opened=!0;var s=e(document,27);assert.isFalse(i.opened,"should close drawer on esc"),assert.isTrue(s.defaultPrevented,"should prevent default"),t()})}),test("scrim",function(){i.transitionDuration=0,assert.equal(window.getComputedStyle(d).opacity,0),i.opened=!0,assert.equal(window.getComputedStyle(d).opacity,1),i.persistent=!0,assert.equal(window.getComputedStyle(d).visibility,"hidden")}),test("tap on scrim closes drawer",function(){i.opened=!0,i.fire("tap",null,{node:d}),assert.isFalse(i.opened)}),test("persistent drawer should not cover content",function(){i.opened=!0,i.persistent=!0,assert.notEqual(document.elementFromPoint(400,10).tagName,"APP-DRAWER")}),test("right persistent drawer should be in the correct position",function(){i.align="right",i.opened=!0,i.persistent=!0,assert.equal(i.getBoundingClientRect().right,window.innerWidth)})});</script>



</body></html>